<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Graphos Services â€” GraphosFRSVCS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
:root{
  --gold:#f1c766;
  --bg:#000;
  --card:#0f0f0f;
  --muted:#9a9a9a;
  --accent:#f1c766;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Poppins",sans-serif;background:var(--bg);color:var(--gold);-webkit-font-smoothing:antialiased}
header{display:flex;align-items:center;gap:14px;justify-content:center;background:linear-gradient(90deg,#000,#111);padding:16px;position:relative}
#site-logo{height:56px;width:56px;border-radius:10px;cursor:pointer;object-fit:cover;border:2px solid rgba(241,199,102,0.12)}
.brand{font-weight:800;font-size:20px}
nav{display:flex;gap:18px;justify-content:center;padding:12px;background:#0b0b0b}
nav a{color:var(--gold);text-decoration:none;font-weight:600}
.hero{padding:56px 18px;text-align:center;font-size:24px;font-weight:700;color:var(--gold)}
.section{background:var(--card);margin:18px;border-radius:14px;padding:22px;box-shadow:0 8px 40px rgba(0,0,0,0.6)}
h2{color:var(--gold);text-align:center;margin:6px 0 18px}
.service-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.card{background:#121212;padding:14px;border-radius:12px;text-align:center;transition:transform .25s,box-shadow .25s;border:1px solid rgba(241,199,102,0.05)}
.card:hover{transform:translateY(-8px);box-shadow:0 12px 40px rgba(241,199,102,0.06)}
.card img{width:100%;height:150px;object-fit:cover;border-radius:10px;margin-bottom:12px}
.card h3{margin:6px 0;color:#fff}
.price-box{background:#0b0b0b;padding:10px;border-radius:10px;color:#fff;margin-top:8px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;justify-content:center}
.btn{background:var(--gold);color:#000;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.small{font-size:13px;color:var(--muted)}
.cart{max-width:880px;margin:0 auto}
.input,select,textarea{display:block;width:100%;padding:10px;border-radius:10px;border:none;background:#0b0b0b;color:#fff;margin-top:8px}
.chat-toggle{position:fixed;left:18px;bottom:18px;background:#111;padding:12px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.6);cursor:pointer;z-index:2000;border:1px solid rgba(241,199,102,0.08)}
.chat-window{position:fixed;right:18px;bottom:18px;width:440px;height:560px;background:#0e0e0e;border-radius:12px;box-shadow:0 20px 80px rgba(0,0,0,0.6);display:none;flex-direction:column;overflow:hidden;z-index:2100}
.chat-header{background:#121212;padding:12px;color:var(--gold);font-weight:800;text-align:center}
.chat-messages{flex:1;padding:12px;overflow:auto;display:flex;flex-direction:column;gap:10px}
.msg.bot{align-self:flex-start;background:#121212;padding:10px;border-radius:10px;color:#fff;max-width:78%;animation:fadeIn .22s}
.msg.user{align-self:flex-end;background:var(--gold);padding:10px;border-radius:10px;color:#000;max-width:78%;font-weight:700}
.chat-input{display:flex;border-top:1px solid rgba(255,255,255,0.03)}
.chat-input input{flex:1;padding:10px;border:none;background:transparent;color:#fff;padding-left:12px}
.quick-buttons{display:flex;flex-wrap:wrap;gap:8px;padding:10px;background:transparent}
.quick-buttons button{flex:1;padding:8px;border-radius:8px;background:#121212;color:var(--gold);border:1px solid rgba(241,199,102,0.06);cursor:pointer}
.admin-panel{position:fixed;top:100px;right:18px;width:340px;background:#0b0b0b;padding:14px;border-radius:12px;box-shadow:0 10px 50px rgba(0,0,0,0.6);display:none;z-index:2200}
.admin-panel h3{color:var(--gold);margin:6px 0 12px}
.admin-row{display:flex;gap:8px;margin-top:8px}
.footer{text-align:center;padding:18px;color:#9a9a9a}
.small-muted{color:var(--muted);font-size:13px}
.hidden{display:none}
.typing{display:flex;gap:6px;align-items:center}
.dot{width:6px;height:6px;border-radius:50%;background:#888;opacity:0.7;animation:bounce 1s infinite}
.dot:nth-child(2){animation-delay:.12s}.dot:nth-child(3){animation-delay:.24s}
@keyframes bounce{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@media(max-width:880px){.chat-window{width:94%;right:3%;bottom:10px;height:60vh}.admin-panel{width:92%;right:4%;top:60px}}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <img id="site-logo" src="" alt="Graphos Logo" title="Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ† Ù„ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Admin)" />
  <div class="brand">Graphos Services</div>
</header>

<!-- NAV -->
<nav>
  <a href="#home" id="nav-home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="#services" id="nav-services">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
  <a href="#payment" id="nav-payment">Ø§Ù„Ø¯ÙØ¹</a>
</nav>

<!-- HERO -->
<section id="home" class="hero">
  Ù…Ù†ØµØ© Ø®Ø¯Ù…Ø§Øª Ø±Ù‚Ù…ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© â€” Ù„ÙˆØ¬ÙˆØŒ ÙÙŠØ¯ÙŠÙˆØŒ Ø¹Ø±ÙˆØ¶ØŒ ØªØ±Ø¬Ù…Ø©ØŒ Ø£ÙÙƒØ§Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ Ù…ÙˆØ§Ù‚Ø¹ â€” Ø³Ø±ÙŠØ¹Ø© ÙˆØ°ÙƒÙŠØ©.
</section>

<!-- 3D background canvas -->
<canvas id="three-bg" style="position:fixed;left:0;top:0;width:100%;height:100%;z-index:-2;opacity:0.08"></canvas>

<!-- SERVICES -->
<section id="services" class="section">
  <h2 id="services-title">Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ ÙˆØ®Ø¯Ù…Ø§ØªÙ†Ø§</h2>
  <div class="service-grid" id="serviceGrid"></div>
  <p class="small-muted" id="services-note" style="text-align:center;margin-top:12px">* Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙØ§ÙˆØ¶ â€” Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù‡ÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
</section>

<!-- PAYMENT -->
<section id="payment" class="section">
  <h2 id="payment-title">Ø§Ù„Ø¯ÙØ¹</h2>
  <div class="cart">
    <p class="small-muted" id="payment-desc">Ø§Ù„Ø¯ÙØ¹ ÙŠØªÙ… Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø£Ùˆ PayPal/STC) Ù‚Ø¨Ù„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø®Ø¯Ù…Ø©. Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚.</p>
    <label id="label-service">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©:</label>
    <select id="service-select" class="input"></select>

    <label id="label-extra">Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label>
    <select id="extra-options" class="input">
      <option value="0">Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ§Øª</option>
      <option value="10">ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… +10 Ø±ÙŠØ§Ù„</option>
      <option value="20">Ø®Ø¯Ù…Ø© Ù…Ù…ÙŠØ²Ø© +20 Ø±ÙŠØ§Ù„</option>
    </select>

    <input id="client-name" class="input" placeholder="Ø§Ø³Ù…Ùƒ" />
    <input id="client-email" class="input" placeholder="Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    <input id="client-amount" class="input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±ÙŠØ§Ù„" readonly />

    <label id="label-method">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
    <select id="client-card" class="input">
      <option value="card">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
      <option value="paypal">PayPal</option>
      <option value="stcpay">STC Pay</option>
    </select>

    <textarea id="client-note" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
    <div class="controls" style="justify-content:center">
      <button class="btn" onclick="submitPayment()">Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†</button>
    </div>

    <p class="small-muted" style="text-align:center;margin-top:12px">
      Ù„Ù„ØªÙˆØ§ØµÙ„: <strong style="color:var(--gold)">0547664748</strong> â€” <a id="wa-link" href="https://wa.me/966547664748" style="color:var(--gold)">ÙˆØ§ØªØ³Ø§Ø¨</a>
    </p>
  </div>
</section>

<!-- CHAT / BOT -->
<div class="chat-toggle" id="openChat">ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯ AI</div>

<div class="chat-window animate__animated animate__fadeInUp" id="chatWindow" role="dialog" aria-label="Chat">
  <div class="chat-header" id="chatHeader">Ù…Ø³Ø§Ø¹Ø¯ Graphos AI</div>

  <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

  <div class="quick-buttons" id="quickButtons"></div>

  <div class="chat-input">
    <input id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." onkeydown="if(event.key==='Enter'){sendMessage();}" />
    <button onclick="sendMessage()" class="btn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<!-- ADMIN (hidden, open by double-click on logo) -->
<div class="admin-panel" id="adminPanel" aria-hidden="true">
  <h3>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Graphos</h3>

  <div id="adminLogin">
    <p class="small-muted">Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø§Ù„Ø²ÙˆØ§Ø± Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ÙˆÙ† Ø§Ù„ÙˆØµÙˆÙ„).</p>
    <input id="adminPass" type="password" class="input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
    <div class="admin-row">
      <button class="btn" onclick="adminLogin()">ØªØ£ÙƒÙŠØ¯</button>
      <button class="btn" style="background:#333;color:var(--gold)" onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <div id="adminContent" class="hidden" aria-hidden="true">
    <label>ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø®Ø¯Ù…Ø©:</label>
    <select id="admin-service-select" class="input"></select>
    <input id="admin-new-price" type="number" class="input" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯" />
    <button class="btn" onclick="updateServicePrice()">Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø±</button>

    <label style="margin-top:12px">Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„Ø®Ø¯Ù…Ø©:</label>
    <input id="admin-upload-img" type="file" accept="image/*" class="input" />
    <div class="admin-row">
      <button class="btn" onclick="uploadServiceImage()">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</button>
      <button class="btn" style="background:#333;color:var(--gold)" onclick="resetServiceImage()">Ø¥Ø¹Ø§Ø¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
    </div>

    <label style="margin-top:12px">Ø±ÙØ¹ Ù„ÙˆØ¬Ùˆ Ø¬Ø¯ÙŠØ¯:</label>
    <input id="admin-upload-logo" type="file" accept="image/*" class="input" />
    <div class="admin-row">
      <button class="btn" onclick="uploadLogo()">Ø±ÙØ¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ</button>
      <button class="btn" style="background:#333;color:var(--gold)" onclick="resetLogo()">Ø¥Ø¹Ø§Ø¯Ø© Ù„ÙˆØ¬Ùˆ</button>
    </div>

    <label style="margin-top:12px">ØªØ¹Ø¯ÙŠÙ„ Ù†ØµÙˆØµ Ø§Ù„Ø¨ÙˆØª (Ø³Ø·Ø±=Ù†Øµ Ø§Ù„Ø±Ø¯ØŒ Ù…Ø«Ø§Ù„: Ù„ÙˆØ¬Ùˆ=Ù†Øµ)</label>
    <textarea id="admin-bot-text" class="input" placeholder="Ù„ÙˆØ¬Ùˆ=Ø®Ø¯Ù…Ø© ØªØµÙ…ÙŠÙ… Ù„ÙˆØ¬Ùˆ..."></textarea>
    <button class="btn" onclick="updateBotText()">ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø¨ÙˆØª</button>

    <div style="margin-top:14px" class="small-muted">Ø§Ù„Ø®Ø±ÙˆØ¬ Ø³ÙŠÙØ¨Ù‚ÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage).</div>
  </div>
</div>

<footer class="footer">
  Graphos Services Â© 2025 â€” Ø¨Ø±ÙŠØ¯: <a href="mailto:Graphos.svcs@gmail.com" style="color:var(--gold)">Graphos.svcs@gmail.com</a>
</footer>

<!-- SCRIPTS -->
<script>
/* ---------------------------
  CONFIG & INITIALIZATION
----------------------------*/
const ADMIN_PASSWORD = "GraphosFRSVCS17"; // Ø·Ù„Ø¨Øª Ù‡Ø°Ø§
const STORAGE_KEY = "graphos_services_v1";
const STORAGE_LOGO = "graphos_logo_v1";
const BOT_TEXTS_KEY = "graphos_bottexts_v1";

/* Default services data */
const DEFAULT_SERVICES = {
  logo: { key:"logo", name_ar:"ØªØµÙ…ÙŠÙ… Ù„ÙˆØ¬Ùˆ", name_en:"Logo Design", price:15, img:"https://via.placeholder.com/640x360?text=Logo" },
  video: { key:"video", name_ar:"ØªØµÙ…ÙŠÙ… ÙÙŠØ¯ÙŠÙˆ", name_en:"Video Production", price:20, img:"https://via.placeholder.com/640x360?text=Video" },
  slides: { key:"slides", name_ar:"Ø¹Ø±ÙˆØ¶ Ø¨Ø§ÙˆØ±Ø¨ÙˆÙŠÙ†Øª", name_en:"Presentation Slides", price:4, img:"https://via.placeholder.com/640x360?text=Slides" },
  full: { key:"full", name_ar:"Ø¹Ø±Ø¶ Ø´Ø§Ù…Ù„", name_en:"Full Package", price:65, img:"https://via.placeholder.com/640x360?text=Full+Package" },
  translate: { key:"translate", name_ar:"ØªØ±Ø¬Ù…Ø©", name_en:"Translation", price:15, img:"https://via.placeholder.com/640x360?text=Translate" },
  ideas: { key:"ideas", name_ar:"Ø£ÙÙƒØ§Ø± Ù…Ø´Ø§Ø±ÙŠØ¹", name_en:"Project Ideas", price:20, img:"https://via.placeholder.com/640x360?text=Ideas" },
  website: { key:"website", name_ar:"ØªØµÙ…ÙŠÙ… Ù…ÙˆÙ‚Ø¹", name_en:"Website Design", price:1500, img:"https://via.placeholder.com/640x360?text=Website" }
};

/* Default bot texts (can be updated via admin) */
const DEFAULT_BOT_TEXTS = {
  "greeting_ar":"Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Graphos Ø§Ù„Ø°ÙƒÙŠ â€” ÙƒÙŠÙ Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",
  "greeting_en":"Hello! I'm the Graphos AI assistant â€” how can I help you today?",
  "logo_ar":"ğŸ¤– Ø®Ø¯Ù…Ø© ØªØµÙ…ÙŠÙ… Ù„ÙˆØ¬Ùˆ Ø§Ø­ØªØ±Ø§ÙÙŠ â€” Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªØ¨Ø¯Ø£ Ù…Ù† 15 Ø±ÙŠØ§Ù„ ÙˆÙŠÙ…ÙƒÙ† ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù…Ù‚Ø§Ø¨Ù„ Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.",
  "logo_en":"ğŸ¤– Professional logo design â€” prices start at 15 SAR; rush delivery available for extra fee.",
  "video_ar":"ğŸ¤– ØªØµÙ…ÙŠÙ… ÙÙŠØ¯ÙŠÙˆ: 30s=20 Ø±ÙŠØ§Ù„ØŒ 60s=30ØŒ 90s=40ØŒ 120s=50.",
  "video_en":"ğŸ¤– Video packages: 30s=20 SAR, 60s=30, 90s=40, 120s=50.",
  "slides_ar":"ğŸ¤– Ø¹Ø±ÙˆØ¶ Ø¨Ø§ÙˆØ±Ø¨ÙˆÙŠÙ†Øª: ÙƒÙ„ Ø´Ø±ÙŠØ­Ø© 4 Ø±ÙŠØ§Ù„ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 5 Ø´Ø±Ø§Ø¦Ø­).",
  "slides_en":"ğŸ¤– Slides: 4 SAR per slide (minimum 5).",
  "full_ar":"ğŸ¤– Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ù…Ù„: Ø®ÙŠØ§Ø± 10 Ø´Ø±Ø§Ø¦Ø­+ÙÙŠØ¯ÙŠÙˆ+Ù„ÙˆØºÙˆ=65 Ø±ÙŠØ§Ù„ Ø£Ùˆ 20 Ø³Ù„Ø§ÙŠØ¯+2min+Ù„ÙˆØºÙˆ=115 Ø±ÙŠØ§Ù„.",
  "full_en":"ğŸ¤– Full package: 10 slides+video+logo for 65 SAR, or 20 slides+2min+logo for 115 SAR.",
  "translate_ar":"ğŸ¤– Ø§Ù„ØªØ±Ø¬Ù…Ø©: ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù†Øµ = 15 Ø±ÙŠØ§Ù„ (Ø­Ø³Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ù†Øµ).",
  "translate_en":"ğŸ¤– Translation: 15 SAR per minute of text (approx).",
  "ideas_ar":"ğŸ¤– Ø£ÙÙƒØ§Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¨ØªÙƒØ±Ø© Ø¨Ø³Ø¹Ø± Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ 20 Ø±ÙŠØ§Ù„ØŒ ÙŠÙ…ÙƒÙ† ØªÙØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.",
  "ideas_en":"ğŸ¤– Project ideas starting at 20 SAR, detailed plans available.",
  "website_ar":"ğŸ¤– ØªØµÙ…ÙŠÙ… Ù…ÙˆÙ‚Ø¹ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¨Ø¯Ø£ Ù…Ù† 1500 Ø±ÙŠØ§Ù„ØŒ ÙŠØªØ¶Ù…Ù† ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ ÙˆÙ…ÙŠØ²Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©.",
  "website_en":"ğŸ¤– Full website design starts at 1500 SAR, responsive and feature-ready."
};

/* Runtime state */
let services = {};
let botTexts = {};
let currentLang = "ar";

/* Utility: local storage load/save */
function loadState(){
  const s = localStorage.getItem(STORAGE_KEY);
  services = s ? JSON.parse(s) : JSON.parse(JSON.stringify(DEFAULT_SERVICES));
  const bl = localStorage.getItem(BOT_TEXTS_KEY);
  botTexts = bl ? JSON.parse(bl) : JSON.parse(JSON.stringify(DEFAULT_BOT_TEXTS));
  const logo = localStorage.getItem(STORAGE_LOGO);
  if(logo) document.getElementById("site-logo").src = logo;
  else document.getElementById("site-logo").src = "https://via.placeholder.com/60?text=G";
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(services));
  localStorage.setItem(BOT_TEXTS_KEY, JSON.stringify(botTexts));
}

/* Initialize UI */
function renderServices(){
  const grid = document.getElementById("serviceGrid");
  grid.innerHTML = "";
  const sel = document.getElementById("service-select");
  const adminSel = document.getElementById("admin-service-select");
  sel.innerHTML = ""; adminSel.innerHTML = "";
  for(const k in services){
    const s = services[k];
    const title = currentLang==="ar"?s.name_ar:s.name_en;
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${s.img}" alt="${title}" />
      <h3>${title}</h3>
      <div class="price-box">${s.price} ${currentLang==="ar" ? "Ø±ÙŠØ§Ù„" : "SAR"}</div>
      <div class="controls">
        <button class="btn" onclick="selectQuick('${s.key}')">${currentLang==="ar"?"Ø§Ø®ØªÙŠØ§Ø±":"Select"}</button>
      </div>
    `;
    grid.appendChild(card);
    const opt = document.createElement("option");
    opt.value = s.key; opt.textContent = title; sel.appendChild(opt);
    const opt2 = document.createElement("option");
    opt2.value = s.key; opt2.textContent = title; adminSel.appendChild(opt2);
  }
  updateAmount();
  renderQuickButtons();
}

/* Quick select a service (via card) */
function selectQuick(key){
  document.getElementById("service-select").value = key;
  updateAmount();
  openChat();
  botSay( currentLang==="ar" ? `Ø§Ø®ØªØ±Øª Ø®Ø¯Ù…Ø© ${services[key].name_ar}. Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ§ØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ù„Ø¨ØŸ` : `You picked ${services[key].name_en}. Need details or place order?` );
  addBotSuggestion(key);
}

/* Quick buttons in chat (service shortcuts) */
function renderQuickButtons(){
  const container = document.getElementById("quickButtons");
  container.innerHTML = "";
  for(const k in services){
    const s = services[k];
    const label = currentLang==="ar"?s.name_ar:s.name_en;
    const btn = document.createElement("button");
    btn.textContent = label;
    btn.onclick = ()=>{ addUserMessage(label); generateAdvancedReply(label, k); };
    container.appendChild(btn);
  }
}

/* -------------------------
  Admin: login, show/hide
--------------------------*/
const adminPanel = document.getElementById("adminPanel");
const adminContent = document.getElementById("adminContent");

function showAdmin(){
  adminPanel.style.display = "block";
}
function closeAdmin(){
  adminPanel.style.display = "none";
  adminContent.classList.add("hidden");
  adminContent.style.display = "none";
  document.getElementById("adminLogin").style.display = "block";
}

/* double-click logo => ask password modal (simple) */
let dblTimer = null;
let dblCount = 0;
const logoEl = document.getElementById("site-logo");
logoEl.addEventListener('click', ()=>{
  dblCount++;
  clearTimeout(dblTimer);
  dblTimer = setTimeout(()=>{ dblCount = 0; }, 500);
  if(dblCount === 2){
    dblCount = 0;
    // show admin panel (login area)
    showAdmin();
    document.getElementById("adminPass").focus();
  }
});

/* Admin login */
function adminLogin(){
  const val = document.getElementById("adminPass").value || "";
  if(val === ADMIN_PASSWORD){
    // show content
    document.getElementById("adminLogin").style.display = "none";
    adminContent.classList.remove("hidden");
    adminContent.style.display = "block";
    sessionStorage.setItem("graphos_admin_logged","1");
    populateAdminFields();
    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„.");
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©.");
  }
}
function populateAdminFields(){
  const sel = document.getElementById("admin-service-select");
  sel.innerHTML = "";
  for(const k in services){
    const o = document.createElement("option");
    o.value = k; o.textContent = services[k][ currentLang==="ar" ? "name_ar":"name_en"];
    sel.appendChild(o);
  }
  document.getElementById("admin-bot-text").value = Object.entries(botTexts).map(([k,v])=>`${k}=${v}`).join("\n");
}

/* Auto-login if sessionStorage set */
if(sessionStorage.getItem("graphos_admin_logged")==="1"){
  showAdmin();
  document.getElementById("adminContent").classList.remove("hidden");
  document.getElementById("adminContent").style.display = "block";
  document.getElementById("adminLogin").style.display = "none";
}

/* Admin actions */
function updateServicePrice(){
  const sel = document.getElementById("admin-service-select").value;
  const price = parseFloat(document.getElementById("admin-new-price").value);
  if(!isNaN(price) && price >= 0){
    services[sel].price = price;
    saveState(); renderServices();
    alert(currentLang==="ar" ? "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±":"Price updated");
  } else alert(currentLang==="ar" ? "Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø±Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§":"Enter a valid price");
}

function uploadLogo(){
  const f = document.getElementById("admin-upload-logo").files[0];
  if(!f){ alert(currentLang==="ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù Ù„ÙˆØ¬Ùˆ":"Choose a logo file"); return; }
  const r = new FileReader();
  r.onload = ()=>{ document.getElementById("site-logo").src = r.result; localStorage.setItem(STORAGE_LOGO, r.result); alert(currentLang==="ar" ? "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ¬Ùˆ":"Logo updated"); };
  r.readAsDataURL(f);
}

function resetLogo(){
  document.getElementById("site-logo").src = "https://via.placeholder.com/60?text=G";
  localStorage.removeItem(STORAGE_LOGO);
  alert(currentLang==="ar" ? "ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ":"Logo reset");
}

function uploadServiceImage(){
  const f = document.getElementById("admin-upload-img").files[0];
  const key = document.getElementById("admin-service-select").value;
  if(!f){ alert(currentLang==="ar" ? "Ø§Ø®ØªØ± ØµÙˆØ±Ø©":"Choose an image"); return; }
  const r = new FileReader();
  r.onload = ()=>{ services[key].img = r.result; saveState(); renderServices(); alert(currentLang==="ar"?"ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©":"Image uploaded"); };
  r.readAsDataURL(f);
}

function resetServiceImage(){
  const key = document.getElementById("admin-service-select").value;
  services[key].img = `https://via.placeholder.com/640x360?text=${encodeURIComponent( services[key].key )}`;
  saveState(); renderServices();
  alert(currentLang==="ar" ? "ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©":"Image reset");
}

function updateBotText(){
  const text = document.getElementById("admin-bot-text").value.trim();
  if(!text){ alert(currentLang==="ar" ? "Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¨ÙˆØª":"Enter bot text"); return; }
  // expected lines of form key=value
  const lines = text.split("\n");
  lines.forEach(line=>{
    const idx = line.indexOf("=");
    if(idx>0){
      const key = line.slice(0,idx).trim();
      const val = line.slice(idx+1).trim();
      if(key) botTexts[key] = val;
    }
  });
  saveState();
  alert(currentLang==="ar" ? "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø¨ÙˆØª":"Bot texts updated");
}

/* -------------------------
  Load saved state then render
--------------------------*/
loadState();
renderServices();

/* If logo not set, set default */
if(!localStorage.getItem(STORAGE_LOGO)) {
  document.getElementById("site-logo").src = "https://via.placeholder.com/60?text=G";
}

/* -------------------------
  Language toggle
--------------------------*/
function setLanguage(lang){
  currentLang = lang;
  // Update UI texts
  document.getElementById("home").querySelector('.hero');
  document.getElementById("services-title").textContent = (lang==="ar" ? "Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ ÙˆØ®Ø¯Ù…Ø§ØªÙ†Ø§" : "Our Products & Services");
  document.getElementById("services-note").textContent = (lang==="ar" ? "* Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙØ§ÙˆØ¶ â€” Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù‡ÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" : "* Prices negotiable â€” Arabic is the default language");
  document.getElementById("payment-title").textContent = (lang==="ar" ? "Ø§Ù„Ø¯ÙØ¹" : "Payment");
  document.getElementById("payment-desc").textContent = (lang==="ar" ? "Ø§Ù„Ø¯ÙØ¹ ÙŠØªÙ… Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø£Ùˆ PayPal/STC) Ù‚Ø¨Ù„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø®Ø¯Ù…Ø©. Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚." : "Payment is via card (or PayPal/STC). Orders will be sent to our email after confirmation.");
  document.getElementById("label-service").textContent = (lang==="ar" ? "Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©:" : "Select service:");
  document.getElementById("label-extra").textContent = (lang==="ar" ? "Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:" : "Extra options:");
  document.getElementById("label-method").textContent = (lang==="ar" ? "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:" : "Payment method:");
  document.getElementById("client-name").placeholder = (lang==="ar" ? "Ø§Ø³Ù…Ùƒ" : "Your name");
  document.getElementById("client-email").placeholder = (lang==="ar" ? "Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" : "Your email");
  document.getElementById("client-note").placeholder = (lang==="ar" ? "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" : "Additional notes");
  document.getElementById("wa-link").textContent = (lang==="ar" ? "ÙˆØ§ØªØ³Ø§Ø¨" : "WhatsApp");
  // update services cards
  renderServices();
  populateAdminFields();
  // update chat greeting
  // if chat open, show greeting in new language
}

/* language switch button */
document.querySelector('.lang-switch').addEventListener('click', ()=>{
  setLanguage(currentLang==="ar" ? "en":"ar");
  alert(currentLang==="ar" ? "ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" : "Switched to English");
});

/* -------------------------
  Payment logic
--------------------------*/
function updateAmount(){
  const sel = document.getElementById("service-select").value;
  const extra = parseFloat(document.getElementById("extra-options").value)||0;
  const s = services[sel];
  const amount = (s? s.price : 0) + extra;
  document.getElementById("client-amount").value = amount;
}

document.getElementById("service-select").addEventListener('change', updateAmount);
document.getElementById("extra-options").addEventListener('change', updateAmount);

/* Submit payment: opens mailto with details to Graphos.svcs@gmail.com */
function submitPayment(){
  const name = document.getElementById("client-name").value.trim();
  const email = document.getElementById("client-email").value.trim();
  const serviceKey = document.getElementById("service-select").value;
  const s = services[serviceKey];
  const extraText = document.getElementById("extra-options").selectedOptions[0].text;
  const amount = document.getElementById("client-amount").value;
  const method = document.getElementById("client-card").value;
  const note = document.getElementById("client-note").value.trim();
  if(!name || !email || !amount){ alert(currentLang==="ar" ? "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" : "Please fill required fields"); return; }
  const subject = encodeURIComponent( currentLang==="ar" ? `Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø© Ù…Ù† ${name}` : `Service order from ${name}` );
  const bodyLines = [
    `${currentLang==="ar" ? "Ø§Ù„Ø§Ø³Ù…":"Name"}: ${name}`,
    `${currentLang==="ar" ? "Ø§Ù„Ø¨Ø±ÙŠØ¯":"Email"}: ${email}`,
    `${currentLang==="ar" ? "Ø§Ù„Ø®Ø¯Ù…Ø©":"Service"}: ${currentLang==="ar" ? s.name_ar : s.name_en }`,
    `${currentLang==="ar" ? "Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª":"Extras"}: ${extraText}`,
    `${currentLang==="ar" ? "Ø§Ù„Ù…Ø¨Ù„Øº":"Amount"}: ${amount} ${currentLang==="ar"?"Ø±ÙŠØ§Ù„":"SAR"}`,
    `${currentLang==="ar" ? "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹":"Payment Method"}: ${method}`,
    `${currentLang==="ar" ? "Ù…Ù„Ø§Ø­Ø¸Ø§Øª":"Notes"}: ${note}`,
    `${currentLang==="ar" ? "ØªÙ… Ø§Ù„Ø¯ÙØ¹":"Payment status"}: ${currentLang==="ar"?"Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…":"before delivery"}`
  ];
  const body = encodeURIComponent(bodyLines.join("\n"));
  const mailto = `mailto:Graphos.svcs@gmail.com?subject=${subject}&body=${body}`;
  window.location.href = mailto;
}

/* -------------------------
  Advanced Bot (option 3)
--------------------------*/
const chatWindow = document.getElementById("chatWindow");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const quickButtonsEl = document.getElementById("quickButtons");
const openChatBtn = document.getElementById("openChat");

openChatBtn.addEventListener('click', openChat);

function openChat(){
  chatWindow.style.display = "flex";
  // initial greeting
  botSay( botTexts[ currentLang==="ar" ? "greeting_ar":"greeting_en" ] );
  renderQuickButtons();
}

function closeChat(){
  chatWindow.style.display = "none";
}

function addUserMessage(text){
  const d = document.createElement("div"); d.className = "msg user"; d.textContent = text; chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addBotMessage(text){
  const d = document.createElement("div"); d.className = "msg bot"; d.textContent = text; chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

/* typing animation */
function showTyping(duration=800){
  const t = document.createElement("div"); t.className = "msg bot typing";
  t.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  chatMessages.appendChild(t);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return t;
}

/* bot say helper */
function botSay(text, delay=700){
  const typ = showTyping();
  setTimeout(()=>{ typ.remove(); addBotMessage(text); }, delay);
}

/* send message from input */
function sendMessage(){
  const txt = chatInput.value.trim();
  if(!txt) return;
  addUserMessage(txt);
  chatInput.value = "";
  // process using advanced pipeline
  setTimeout(()=>{ generateAdvancedReply(txt); }, 350);
}

/* Advanced reply generator - heuristic + templates */
function generateAdvancedReply(userText, forcedKey=null){
  const ut = (userText||"").toLowerCase();
  // prioritize forcedKey (from quick button)
  if(forcedKey){
    const s = services[forcedKey];
    const text = currentLang==="ar" ? botTexts[`${forcedKey}_ar`] || botTexts["logo_ar"] : botTexts[`${forcedKey}_en`] || botTexts["logo_en"];
    botSay(text, 500);
    // offer upsells
    offerUpsells(forcedKey);
    return;
  }
  // intents
  // 1. ask price
  if( /Ø³Ø¹Ø±|ÙƒÙ…|price|cost/.test(ut) ){
    // try to find mentioned service
    for(const k in services){
      if(ut.includes(k) || ut.includes( services[k].name_ar.toLowerCase() ) || ut.includes( services[k].name_en.toLowerCase() )){
        const s = services[k];
        botSay( currentLang==="ar" ? `Ø³Ø¹Ø± ${s.name_ar} Ù‡Ùˆ ${s.price} Ø±ÙŠØ§Ù„.` : `${s.name_en} costs ${s.price} SAR.`, 600 );
        offerUpsells(k);
        return;
      }
    }
    // fallback: give list
    const list = Object.values(services).map(s=> currentLang==="ar" ? `${s.name_ar}: ${s.price} Ø±ÙŠØ§Ù„` : `${s.name_en}: ${s.price} SAR`).join("\n");
    botSay( currentLang==="ar" ? `Ù‡Ø°Ù‡ Ø£Ø³Ø¹Ø§Ø±Ù†Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:\n${list}` : `Here are our base prices:\n${list}`, 700 );
    return;
  }

  // 2. ordering intent
  if( /Ø§Ø·Ù„Ø¨|Ø£Ø±ÙŠØ¯|order|buy|Ø§Ø´ØªØ±ÙŠ/.test(ut) ){
    // try to extract service mention
    for(const k in services){
      if(ut.includes(k) || ut.includes(services[k].name_ar.toLowerCase()) || ut.includes(services[k].name_en.toLowerCase())){
        // prepare order
        const s = services[k];
        botSay( currentLang==="ar" ? `Ø­Ø³Ù†Ù‹Ø§ØŒ Ø£Ø¬Ù‡Ø² Ù„Ùƒ Ø·Ù„Ø¨ ${s.name_ar}. Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†" ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹.` : `Great â€” preparing an order for ${s.name_en}. Choose extras and click "Pay Now".`, 700 );
        // switch to payment tab
        document.getElementById('service-select').value = k; updateAmount();
        document.getElementById('nav-payment').click();
        return;
      }
    }
    botSay( currentLang==="ar" ? "Ù‡Ù„ ØªÙˆØ¯ Ø£Ù† Ø£Ø¬Ù‡Ø² Ù„Ùƒ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ØŸ Ø£ÙŠ Ø®Ø¯Ù…Ø© ØªÙØ¶Ù„ØŸ" : "Would you like me to prepare an order form? Which service would you like?", 700 );
    renderQuickButtons();
    return;
  }

  // 3. help / greeting
  if( /Ù…Ø±Ø­Ø¨Ø§|Ù…Ø±Ø­Ø¨Ø§|hello|hi|salut/.test(ut) ) {
    botSay( currentLang==="ar" ? botTexts["greeting_ar"] : botTexts["greeting_en"], 500 );
    return;
  }

  // 4. translate or examples
  if( /ØªØ±Ø¬Ù…|translate|meaning/.test(ut) ){
    botSay( currentLang==="ar" ? "Ø£Ø±Ø³Ù„ Ù„ÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ±Ø¬Ù…ØªÙ‡ ÙˆØ³Ø£Ø¹Ø·ÙŠÙƒ ØªØ±Ø¬Ù…Ø© Ø³Ø±ÙŠØ¹Ø©." : "Send the text you want translated and I'll provide a quick translation.", 700 );
    return;
  }

  // 5. website / portfolio
  if( /Ù…ÙˆÙ‚Ø¹|website|site/.test(ut) ){
    const s = services['website'];
    botSay( currentLang==="ar" ? botTexts["website_ar"] : botTexts["website_en"], 700 );
    offerUpsells('website');
    return;
  }

  // 6. fallback - try to suggest nearest service by keyword match
  let best = null; let bestScore=0;
  for(const k in services){
    const s = services[k];
    let score = 0;
    const tokens = (s.name_ar + " " + s.name_en).toLowerCase();
    if(tokens.includes("logo") && ut.includes("logo")) score+=2;
    if(tokens.split(" ").some(t=> ut.includes(t))) score++;
    if(score>bestScore){ best=k; bestScore=score; }
  }
  if(best && bestScore>0){
    const s = services[best];
    botSay( currentLang==="ar" ? `Ù‡Ù„ ØªÙ‚ØµØ¯ ${s.name_ar}ØŸ` : `Do you mean ${s.name_en}?`, 600 );
    offerUpsells(best);
    return;
  }

  // final fallback: ask clarifying question and show suggestions
  botSay( currentLang==="ar" ? "Ù…Ø¹Ù„ÙŠØ´ Ù…Ø§ ÙÙ‡Ù…Øª ØªÙ…Ø§Ù…Ù‹Ø§ØŒ ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ø£Ùˆ ØªØ³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±." : "Sorry, I didn't fully understand. Choose a service below or ask about prices.", 700 );
  renderQuickButtons();
}

/* Offer upsells: after describing a service, suggest extras and link to payment */
function offerUpsells(serviceKey){
  const s = services[serviceKey];
  setTimeout(()=>{
    const upsell = currentLang==="ar"
      ? `ØªÙ‚Ø¯Ø± ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù…Ù‚Ø§Ø¨Ù„ +10 Ø±ÙŠØ§Ù„ Ø£Ùˆ Ø®Ø¯Ù…Ø© Ù…Ù…ÙŠØ²Ø© +20 Ø±ÙŠØ§Ù„. Ù„Ø·Ù„Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø«Ù… ØªÙˆØ¬Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹.`
      : `You can rush delivery for +10 SAR or premium service +20 SAR. To order, select and go to Payment page.`;
    botSay(upsell, 900);
  }, 700);
}

/* add bot suggestion (helper when user selects card) */
function addBotSuggestion(key){
  const s = services[key];
  setTimeout(()=>{ botSay( currentLang==="ar" ? `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† Ø£Ø¬Ù‡Ø² Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ù„Ù€ ${s.name_ar} Ø§Ù„Ø¢Ù†ØŸ` : `Shall I prepare an order form for ${s.name_en} now?` , 700); }, 400);
}

/* quickReply from quick-buttons in UI */
function generateAdvancedReply(label, forcedKey){
  addUserMessage(label);
  generateAdvancedReply_internal(label, forcedKey);
}
function generateAdvancedReply_internal(label, forcedKey){
  // if forcedKey supplied, call generateAdvancedReply with forcedKey
  generateAdvancedReply(label, forcedKey); // note: earlier function handles forcedKey
}

/* -------------------------
  Helpers for chat UI
--------------------------*/
function addUserMessage(text){
  const d = document.createElement('div'); d.className = 'msg user'; d.textContent = text; chatMessages.appendChild(d); chatMessages.scrollTop = chatMessages.scrollHeight;
}
function botSayImmediate(text){
  addBotMessage(text);
}
function addBotMessage(text){
  const d = document.createElement('div'); d.className = 'msg bot'; d.textContent = text; chatMessages.appendChild(d); chatMessages.scrollTop = chatMessages.scrollHeight;
}

/* -------------------------
  Data persistence
--------------------------*/
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(services));
  localStorage.setItem(BOT_TEXTS_KEY, JSON.stringify(botTexts));
}
function loadState(){
  const s = localStorage.getItem(STORAGE_KEY);
  if(s) services = JSON.parse(s);
  const b = localStorage.getItem(BOT_TEXTS_KEY);
  if(b) botTexts = JSON.parse(b);
}
loadState();

/* on page load ensure selects filled */
renderServices();
populateAdminFields();

/* If admin session set, show admin content */
if(sessionStorage.getItem("graphos_admin_logged")==="1"){
  showAdmin();
  document.getElementById("adminLogin").style.display = "none";
  document.getElementById("adminContent").classList.remove("hidden");
  document.getElementById("adminContent").style.display = "block";
  populateAdminFields();
}

/* If logo in storage, set it */
const storedLogo = localStorage.getItem(STORAGE_LOGO);
if(storedLogo) document.getElementById("site-logo").src = storedLogo;

/* quick open to payment nav when click nav */
document.getElementById("nav-payment").addEventListener('click', ()=>{ location.hash = "#payment"; window.scrollTo({top:document.getElementById('payment').offsetTop-20, behavior:'smooth'}); });

/* navigation interactions for services */
document.getElementById("nav-services").addEventListener('click', ()=>{ location.hash="#services"; window.scrollTo({top:document.getElementById('services').offsetTop-20, behavior:'smooth'}); });

/* open chat auto on first visit? no â€” left to user */

/* Three.js minimal decorative background (no heavy libs) */
(function threeBackground(){
  try{
    const canvas = document.getElementById('three-bg');
    const ctx = canvas.getContext('2d');
    function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
    resize(); window.addEventListener('resize', resize);
    // draw rotating gradient rings (lightweight)
    let t=0;
    function frame(){
      t+=0.005;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const cx = canvas.width/2, cy = canvas.height/2;
      for(let i=0;i<6;i++){
        const r = 200 + i*60;
        ctx.beginPath();
        ctx.strokeStyle = `rgba(241,199,102,${0.02 + i*0.01})`;
        ctx.lineWidth = 1.5;
        ctx.arc(cx + Math.cos(t*(0.8+i*0.3))*30, cy + Math.sin(t*(0.7+i*0.25))*20, r, 0, Math.PI*2);
        ctx.stroke();
      }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }catch(e){console.warn("canvas bg skip", e);}
})();

/* Ensure initial values */
updateAmount();

/* Exported small helpers for debug in console */
window.Graphos = {
  services, botTexts, saveState, loadState, openChat, closeAdmin, adminLogin
};

</script>
</body>
</html>
